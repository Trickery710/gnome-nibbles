name: gnome-nibbles
adopt-info: gnome-nibbles
summary: Guide a worm around a maze
description: |
  Control a worm in its quest to eat bonuses and become longer. Outmaneuver
  enemy worms while eating doughnuts and ice cream to increase your length.
  Each worm has ten lives and loses one by running into a wall, another worm,
  or itself. The enemy worms are after the same bonuses that you are, so be
  careful: if they become too large, you wonâ€™t have much room for movement.

  The adventure progresses through 26 maps of increasing difficulty. The early
  levels are mostly open with a few walls, but later on, cramped spaces and
  teleporters make things more interesting.

  Play on your own against up to five enemy worms, or share your keyboard to
  play with a friend.

grade: stable # must be 'stable' to release into candidate/stable channels
confinement: strict
base: core18

plugs:
  gnome-3-28-1804:
    interface: content
    target: $SNAP/gnome-platform
    default-provider: gnome-3-28-1804
  gtk-3-themes:
    interface: content
    target: $SNAP/data-dir/themes
    default-provider: gtk-common-themes
  icon-themes:
    interface: content
    target: $SNAP/data-dir/icons
    default-provider: gtk-common-themes
  sound-themes:
    interface: content
    target: $SNAP/data-dir/sounds
    default-provider: gtk-common-themes

slots:
  # for GtkApplication registration
  gnome-nibbles:
    interface: dbus
    bus: session
    name: org.gnome.Nibbles

apps:
  gnome-nibbles:
    command: desktop-launch snapcraft-preload gnome-nibbles
    plugs:
      - desktop
      - desktop-legacy
      - gsettings
      - opengl
      - pulseaudio
      - unity7
      - wayland
    desktop: usr/share/applications/org.gnome.Nibbles.desktop

parts:
# Needed by clutter
  snapcraft-preload:
    source: https://github.com/sergiusens/snapcraft-preload.git
    plugin: cmake
    build-packages:
      - gcc-multilib
      - g++-multilib

  libcanberra:
    source: git://git.0pointer.de/libcanberra
    source-type: git
    plugin: autotools
    configflags:
      - --prefix=/snap/gnome-nibbles/current/usr
      - --enable-pulse
      - --enable-gstreamer
      - --enable-gtk3
      - --enable-alsa
      - --disable-oss
    organize:
      snap/gnome-nibblees/current/usr: usr
    build-packages:
      - libltdl-dev
      - libasound2-dev
      - libvorbis-dev
      - libgtk-3-dev
      - libtdb-dev
      - libpulse-dev
      - libgstreamer1.0-dev
      - gtk-doc-tools

  desktop-gnome-platform:
    source: https://github.com/ubuntu/snapcraft-desktop-helpers.git
    source-subdir: gtk
    plugin: make
    make-parameters: ["FLAVOR=gtk3"]
    build-packages:
      - build-essential
      - libgtk-3-dev
    override-build: |
      snapcraftctl build
      mkdir -pv $SNAPCRAFT_PART_INSTALL/gnome-platform

  gnome-nibbles:
    after: [desktop-gnome-platform, libcanberra]
    source: https://gitlab.gnome.org/GNOME/gnome-nibbles.git
    source-type: git
    source-tag: 3.34.0
    plugin: meson
    override-pull: |
      snapcraftctl pull
      snapcraftctl set-version $(git describe --tags --abbrev=10)
    override-build: |
      sed -i.bak -e 's|=org.gnome.Nibbles$|=${SNAP}/meta/gui/org.gnome.Nibbles.svg|g' data/org.gnome.Nibbles.desktop.in
      snapcraftctl build
      mkdir -p $SNAPCRAFT_PART_INSTALL/meta/gui/
      cp ../src/data/icons/hicolor/scalable/org.gnome.Nibbles.svg $SNAPCRAFT_PART_INSTALL/meta/gui/
    meson-parameters: [--prefix=/snap/gnome-nibbles/current/usr]
    organize:
      snap/gnome-nibbles/current/usr: usr
    build-packages:
      - gettext
      - gnome-common
      - intltool
      - appstream-util
      - libcanberra-gtk3-dev
      - libclutter-1.0-dev
      - libclutter-gtk-1.0-dev
      - libglib2.0-dev
      - libgsound-dev
      - libgtk-3-dev
      - librsvg2-dev
      - yelp-tools
      - libgnome-games-support-1-dev
      - libgee-0.8-dev
      - valac
  libraries:
    plugin: nil
    stage-packages:
      - libclutter-gtk-1.0-0
      - libgnome-games-support-1-3
      - libgee-0.8-2
      - libgsound0
    prime:
      - "usr/lib/*/libgnome-games-support-1.so.*"
      - "usr/lib/*/libgee-0.8.so.*"
      - "usr/lib/*/libgsound.so.*"
